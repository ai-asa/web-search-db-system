import configparser
from datetime import datetime

class GetPrompt:

   def __init__(self):
       pass

def get_article_selection_prompt():
    """
    保険営業の時事ネタとして使用できる記事を選別するためのプロンプト
    
    Returns:
        str: 記事選別用プロンプト
    """
    return """あなたは保険営業のアシスタントです。
提供されたニュース記事のリストから、保険営業の導入の話題として活用できる記事を選別してください。

以下のような記事を選択してください：
1. 生活や健康に関する話題
2. 自然災害や事故に関するニュース
3. 経済や金融に関する一般的な話題
4. 社会保障や制度変更に関するニュース
5. 家族や生活設計に関連する話題

以下のような記事は避けてください：
1. 政治的な対立を含む話題
2. 犯罪や事件に関する詳細な報道
3. 宗教に関する話題
4. センシティブな社会問題
5. 企業の内部問題や不祥事
6. 特定の企業に限定した制度変更

出力形式：
<reasoning>
[選択理由を簡潔に説明。該当する記事がない場合は「該当する記事が見つかりませんでした」と記載]
</reasoning>

<selected_articles>
[選択した記事の番号をカンマ区切りで列挙。該当する記事がない場合は空の配列 [] を出力]
</selected_articles>

注意事項：
- 記事番号のみをリスト形式で出力してください
- 該当する記事がない場合は0件でも構いません
- 記事の選択理由は、保険商品との関連性を具体的に説明してください

以下の記事から、保険営業の時事ネタとして活用できる記事を選んでください："""

def get_article_grouping_prompt():
    """
    選別された記事から、同一内容の記事をグループ化するためのプロンプト
    
    Returns:
        str: 記事グループ化用プロンプト
    """
    return """あなたは保険営業のアシスタントです。
提供された記事から、完全に同一の出来事や事象について報じている記事をグループ化してください。

グループ化の基準：
1. 同一の出来事についての連続した報道
   例）「大雪による通行止めの開始」→「通行止めの状況」→「通行止めの解除」など

2. 同一の政策や制度変更についての連続した報道
   例）「政策変更の検討」→「政策変更の決定」→「政策変更の実施」など

3. グループ化のルール
   - 完全に同一の事象・出来事を扱っている記事のみをグループ化
   - 似ているだけの記事は別グループとして扱う
   - 単独の記事は「その他」グループにまとめる
   - 時系列的な連続性がある記事のみをグループ化

出力形式：
<reasoning>
[グループ化の理由を説明
- 各グループの記事がどのように同一の出来事を扱っているか
- 時系列的な連続性の説明
- グループ化できない記事をその他とした理由]
</reasoning>

<grouped_articles>
{
    "group1": {
        "title": "グループの内容を端的に表すタイトル",
        "articles": [記事番号のリスト]
    },
    "group2": {
        "title": "グループの内容を端的に表すタイトル",
        "articles": [記事番号のリスト]
    },
    "others": {
        "title": "その他の個別記事",
        "articles": [グループ化できなかった記事の番号のリスト]
    }
}
</grouped_articles>

注意事項：
- 同一の出来事・事象を扱う記事のみをグループ化してください
- 似ているだけの記事は別グループまたはその他に分類してください
- 各記事は必ず1つのグループにのみ属するようにしてください
- グループ名は具体的な内容を示すものにしてください
- 時系列的な連続性を重視してグループ化してください

以下の記事から、同一内容の記事をグループ化してください："""

def get_article_content_summarize_prompt():
    """
    記事内容を要約するためのプロンプトを返す
    
    Returns:
        str: 要約用プロンプト
    """
    return """あなたは記事内容を要約する専門家です。
複数の記事の内容を、本質的な情報を保持しながら要約してください。

要約の基準：
1. 可能な限り元記事の内容を網羅する
2. 記事間で重複する情報は統合する
3. 時系列的な流れがある場合は、その順序を保持する
4. 具体的な数値や事実は可能な限り保持する
5. 各記事の出典の情報は確実に保持する

出力形式：
<summary>
[要約された記事内容をここに記述]
</summary>

注意事項：
- 要約は元の内容の本質を損なわないようにしてください
- 複数の記事の内容を自然な流れで統合してください
- 重要な事実や数値は具体的に記載してください
- 記事の出典情報は保持してください"""

def get_article_search_keywords_prompt():
    """
    記事の内容から検索キーワードを生成するためのプロンプトを返します
    
    Returns:
        str: 検索キーワード生成用のプロンプト
    """
    return """
あなたは断片情報について検索するための検索キーワードを生成するAIアシスタントです。
与えられた断片情報から、正確な情報を得るための最適な検索キーワードを生成してください。

以下の記事情報から、検索に最適なキーワードを2つ生成してください：

断片情報：
{extracted_info}

出力形式：
<search_keywords>
[
  "検索キーワード1",
  "検索キーワード2"
]
</search_keywords>

キーワード生成の注意点：
- 各キーワードは1〜2単語で構成してください
- 具体的で検索結果が絞られるようなキーワードを選んでください
- 記事の主要なトピック、人物、組織、出来事に焦点を当ててください
- 各キーワードは異なる観点から記事の内容を補完するものにしてください
"""

# 相変わらず飛躍がひどい
# だが、この前の段階で止めておくべき。問題なのはここではない

def get_article_detail_prompt():
    """
    記事の詳細情報を生成するためのプロンプトを返す
    
    Returns:
        str: 詳細情報生成用プロンプト
    """
    return """あなたは保険営業のための情報分析アシスタントです。
提供された記事内容から、保険営業での活用を前提に、事実関係を詳細に保持しつつ、その情報がどのような顧客層にどのような保険商品の提案機会として活用できるかを分析してください。

以下の点に注意して情報記事を作成してください：
1. 記事の事実関係を詳細かつ正確に保持
   - 記事内の具体的な出来事や状況説明を記録
   - 日時や時系列情報を明確に記録
   - 出典情報を確実に保持
   - 具体的な数値やデータを保持
   - 関係する組織や人物の情報を保持

2. 記事が示唆する社会的な意味や影響を分析
   - 社会の変化や傾向の分析
   - 人々の生活への影響
   - 将来的な展開の可能性
   - 保険ニーズとの関連性（無理な関連付けは避ける）

3. 想定できる保険顧客層の分析
   - 年齢層、性別、職業、家族構成、収入層、居住地など
   - この記事の話題に関心を持つ理由
   - その層特有の不安や関心事
   - 提案可能な保険商品の種類（生命保険、医療保険、がん保険、学資保険など）
   - なぜその保険商品が適切か

4. 自然な会話展開の設計
   - 記事の話題から始める自然な導入
   - 顧客の共感を引き出す展開
   - 顧客の状況に応じた話題の発展
   - 保険の話題への自然な接続

出力形式：
<detail_article>
{{
    "title": "情報記事のタイトル（端的に内容を表現）",
    "content": "詳細な情報記事の本文（日時・時系列・出典情報を含む）",
    "target_customers": "想定される保険顧客層の特徴（年齢層、性別、職業、家族構成、収入層、居住地など）と提案可能な保険商品、その理由の説明",
    "usage_example": "この記事の話題から保険の提案までの具体的な会話展開例（自然な導入から保険の話題までの流れ）"
}}
</detail_article>

注意事項：
- 事実関係は必ず時系列順に整理し、日時情報を明確に記載してください
- 出典情報は必ず保持してください
- 保険商品との関連付けは、顧客のニーズや状況から自然に導かれるものに限定してください
- 会話例は、押し付けがましくない、自然な流れを重視してください
- センシティブな内容は避けてください

以下の情報を基に詳細な情報記事を作成してください：

【抽出された本質的な情報】
{extracted_info}

【記事内容】
{combined_content}"""

def get_article_similarity_check_prompt():
    """
    2つの記事情報が同じ内容または同じ時系列の情報かを判断するためのプロンプト
    
    Returns:
        str: 類似性判断用プロンプト
    """
    return """あなたは記事の類似性を判断する専門家です。
2つの記事情報を比較し、同じ内容または同じ時系列の情報かどうかを判断してください。

判断基準：
1. 同一の出来事や事象を扱っているか
2. 時系列的な連続性があるか（例：同じ出来事の進展を報じているか）
3. 同じ社会的変化や傾向を示唆しているか
4. 同じニーズや課題に関する情報か

出力形式：
<similarity_check>
{{
    "is_similar": true/false,
    "reasoning": "判断理由の説明"
}}
</similarity_check>

注意事項：
- 表面的な類似性ではなく、情報の本質的な類似性を判断してください
- 時系列的な連続性がある場合も「類似」と判断してください
- 判断理由は具体的に説明してください

以下の2つの記事情報を比較してください：

【記事1】
タイトル：{title1}
内容：{content1}

【記事2】
タイトル：{title2}
内容：{content2}"""

def get_article_merge_prompt():
    """
    類似する記事情報を結合するためのプロンプト
    
    Returns:
        str: 記事結合用プロンプト
    """
    return """あなたは記事情報を整理して保険営業の導入トークを作成する専門家です。
類似する複数の記事情報を、より包括的で価値のある1つの情報に結合したのち、それを保険営業のアイスブレイクとして活用する方法を提案してください。

結合の基準：
1. 記事の事実関係を詳細かつ正確に保持
   - 記事内の具体的な出来事や状況説明を記録
   - 日時や時系列情報を明確に記録
   - 出典情報を確実に保持
   - 具体的な数値やデータを保持
   - 関係する組織や人物の情報を保持
   - 新しい情報を優先する

2. 想定できる保険顧客層の分析
   - 年齢層、性別、職業、家族構成、収入層、居住地など
   - この記事の話題に関心を持つ理由
   - その層特有の不安や関心事
   - 提案可能な保険商品の種類（生命保険、医療保険、がん保険、学資保険など）
   - なぜその保険商品が適切か

3. 自然な会話展開の設計
   - 記事の話題から始める自然な導入
   - 顧客の共感を引き出す展開
   - 顧客の状況に応じた話題の発展
   - 保険の話題への自然な接続

出力形式：
<merged_article>
{{
    "title": "情報記事のタイトル（端的に内容を表現）",
    "content": "詳細な情報記事の本文（日時・時系列・出典情報を含む）",
    "target_customers": "想定される保険顧客層の特徴（年齢層、性別、職業、家族構成、収入層、居住地など）と提案可能な保険商品、その理由の説明",
    "usage_example": "この記事の話題から保険の提案までの具体的な会話展開例（自然な導入から保険の話題までの流れ）"
}}
</merged_article>

注意事項：
- 事実関係は必ず時系列順に整理し、日時情報を明確に記載してください
- 出典情報は必ず保持してください
- 保険商品との関連付けは、顧客のニーズや状況から自然に導かれるものに限定してください
- 会話例は、押し付けがましくない、自然な流れを重視してください
- センシティブな内容は避けてください

以下の記事情報を結合してください：

{articles_info}"""

def get_article_retention_period_prompt():
    """
    記事の保持期間を判断するためのプロンプト
    
    Returns:
        str: 保持期間判断用プロンプト
    """
    return """あなたは記事の時事性と影響力を分析し、データベースでの保持期間を判断する専門家です。
提供された記事のタイトルから、その情報の価値持続期間を判断してください。

判断基準：
1. 7日間の保持（短期）
   - 一時的な出来事や状況の報道
   - 速報性の高いニュース
   - 一過性の話題や現象
   - 天候や交通情報など、即時性の高い情報

2. 30日間の保持（中期）
   - 月単位で影響が続く出来事
   - 社会的な変化の兆候を示す情報
   - 季節に関連する話題
   - 中期的な経済動向や市場の変化

3. 180日間の保持（長期）
   - 社会システムや制度の変更に関する情報
   - 長期的な影響を持つ政策や法改正
   - 人々の生活様式や価値観の変化を示す情報
   - 技術革新や社会構造の変化に関する情報

出力形式：
<retention_periods>
{
    "article_periods": [
        {
            "number": 記事番号,
            "days": 保持日数（7/30/180のいずれか）,
            "reasoning": "判断理由の簡潔な説明"
        }
    ]
}
</retention_periods>

注意事項：
- 保持日数は必ず7、30、180のいずれかを選択してください
- 時事性と影響力のバランスを考慮してください
- 判断理由は簡潔に1文で説明してください

以下の記事タイトルから、それぞれの保持期間を判断してください："""

def get_initial_article_analysis_prompt():
    """
    記事から本質情報を抽出し、生命保険営業における会話の導入と関連性を判断するためのプロンプト
    
    Returns:
        str: 初期分析用プロンプト
    """
    return """あなたは生命保険営業のアシスタントです。
提供された記事から本質的な情報を抽出し、その情報の生命保険営業における活用可能性を判断してください。

分析の基準：
1. 本質情報の抽出
   - 社会の変化や傾向を示唆する情報
   - 人々の関心や不安、ニーズを反映する情報
   - 具体的な事実や状況に基づく情報
   - 一時的でない、継続的な影響を持つ情報

2. 会話の導入としての適切性
   - 日常会話で自然に触れられる内容か
   - センシティブすぎない、重すぎない内容か
   - 相手の生活実態や経験と結びつけやすいか
   - 一般的な社会常識の範囲内で理解できる内容か

3. 生命保険商品の会話導入としての活用可能性
   - 記事の内容から生命保険の話題へ自然に展開できるか
   - 顧客の生活保障や将来の経済的リスクへの意識を高める内容か
   - 生命保険商品（死亡保障、医療保険、がん保険、介護保険、年金保険、学資保険など）の必要性を感じさせる内容か
   - 押し付けがましくなく、自然な会話の流れで保険の話題に繋げられるか

出力形式：
<analysis>
{
    "extracted_info": "記事から抽出した本質的な情報（社会の変化・傾向、人々のニーズなどを1文でまとめたもの）",
    "conversation_starter": {
        "is_appropriate": true/false,
        "reasoning": "会話の導入として適切か不適切かの理由"
    },
    "insurance_relevance": {
        "is_usable": true/false,
        "reasoning": "生命保険商品の会話導入として活用できるかどうかの理由",
        "conversation_example": "記事の内容からいずれかの生命保険商品を顧客に訴求する際の具体的な会話例（記事の話題から始まり、自然な流れで保険の話題に繋げる会話の流れ）"
    }
}
</analysis>

注意事項：
- 本質情報は、記事の表面的な内容ではなく、その背景にある社会的な意味や影響を抽出してください
- 会話の導入としての適切性は、一般的な雑談として自然に話題にできるかを判断してください
- 生命保険商品の会話導入としての活用可能性は、無理なこじつけを避け、自然な会話の流れを重視してください
- 会話例は、押し付けがましくない、顧客の共感を得られる自然な流れを意識してください
- 損害保険に関する内容は対象外としてください
- 政治的、宗教的、センシティブな内容は避けてください
- 必ずJSONの各プロパティ名をダブルクォートで囲んでください
- true/falseは必ず小文字で記述してください

以下の記事を分析してください："""

def get_relevance_validation_prompt():
    """
    生命保険商品との関連性の妥当性と会話の自然さを検証するためのプロンプト
    
    Returns:
        str: 関連性と会話の自然さ検証用プロンプト
    """
    return """あなたは生命保険営業における話題の適切性と会話の自然さを判断する専門家です。
提供された情報と生命保険商品との関連性について、論理の飛躍やこじつけがないか、また会話の流れに不自然さがないかを厳密に検証してください。

検証の基準：
1. 論理的な繋がり
   - 話題から生命保険の話題への展開が自然か
   - 前提から結論までの論理展開に飛躍がないか
   - 因果関係が明確で説得力があるか

2. 顧客との関連性
   - 顧客の具体的な状況や生命保険に関するニーズと結びつくか
   - 顧客が実感できる具体的な生活保障やリスク対策の課題があるか
   - 顧客が得られるメリットを強調できる情報であるか
   - 生命保険による解決策が明確か

3. こじつけの回避
   - 日常から乖離したリスクを提示していないか
   - 無理な関連付けをしていないか
   - 一般的な常識の範囲内での解釈か
   - 生命保険商品（死亡保障、医療保険、がん保険、介護保険、年金保険、学資保険など）の特徴や機能と自然に結びつくか

出力形式：
<validation>
{{
    "is_valid": true/false,
    "reasoning": "判断理由の詳細な説明",
    "target_customers": "（Falseの場合は空文字）この話題が特に効果的な顧客層の具体的な特徴(年齢、職業、家族構成、収入層、居住地など)"
}}
</validation>

判定基準：
- is_valid = true の条件：
  1. 話題から生命保険の話題への展開が自然であること
  2. 顧客の状況や生命保険に関するニーズと結びつくこと
  3. 会話の流れに不自然さや押し付けがましさがないこと
  上記のすべてを満たす場合のみtrueとしてください

以下の場合はfalseとしてください：
1. 話題と生命保険の結びつきに無理がある場合
2. 会話の流れに不自然さや唐突さがある場合
3. 押し付けがましく、顧客の共感を得られない内容の場合
4. 一般的な常識から外れた解釈が必要な場合
5. 損害保険に関する内容の場合

注意事項：
- 関連性の理由と会話の自然さの両方を評価してください
- 少しでも会話の自然さに無理がある場合はfalseとしてください
- target_customersは、年齢、職業、家族構成、収入層、居住地など、具体的な属性で定義してください
- 損害保険に関する内容は対象外としてください

以下の情報を検証してください：

【抽出された本質情報】
{extracted_info}

【保険商品との関連性の理由】
{reasoning}

【会話例】
{conversation_example}"""